CREATE COMPUTE MODULE CreateRequestPayload_Compute
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		CALL CopyMessageHeaders();

		-- Declare namespaces
		DECLARE ns1 NAMESPACE 'urn:iso:std:iso:20022:tech:xsd:head.001.001.02';
		DECLARE ns2 NAMESPACE 'urn:iso:std:iso:20022:tech:xsd:admi.004.001.02';
		DECLARE xsi NAMESPACE 'urn:iso:std:iso:20022:tech:xsd:Header';

		-- Create RequestPayload root
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload;

		-- AppHdr with prefix binding
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr;
		SET OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.(XMLNSC.NamespaceDecl)xmlns:ns1 = ns1;
		SET OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.(XMLNSC.NamespaceDecl)xmlns:xsi = xsi;

		-- AppHdr -> Fr
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:Fr.ns1:FIId.ns1:FinInstnId.ns1:ClrSysMmbId.ns1:MmbId VALUE 'RBIP0NEFTSC';

		-- AppHdr -> To
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:To.ns1:FIId.ns1:FinInstnId.ns1:ClrSysMmbId.ns1:MmbId VALUE 'GSCB0000001';

		-- AppHdr other fields
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:BizMsgIdr VALUE 'GSCB202412105310110020';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:MsgDefIdr VALUE 'admi.004.001.02';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:BizSvc VALUE 'NEFT';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.ns1:AppHdr.ns1:CreDt VALUE '2024-12-10T12:26:49Z';

		-- Document with default namespace (no prefix)
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.Document;
		SET OutputRoot.XMLNSC.RequestPayload.Document.(XMLNSC.NamespaceDecl)xmlns = ns2;

		-- Document -> SysEvtNtfctn
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.Document.SysEvtNtfctn.EvtInf.EvtCd VALUE 'F27';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.Document.SysEvtNtfctn.EvtInf.EvtParam VALUE 'PBAPI000000';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.Document.SysEvtNtfctn.EvtInf.EvtDesc VALUE 'Message sent successfully.';
		CREATE FIELD OutputRoot.XMLNSC.RequestPayload.Document.SysEvtNtfctn.EvtInf.EvtTm VALUE '2024-12-10T12:26:49';

		RETURN TRUE;
	END;

	CREATE PROCEDURE CopyMessageHeaders() BEGIN
		DECLARE I INTEGER 1;
		DECLARE J INTEGER CARDINALITY(InputRoot.*[]);
		WHILE I < J DO
			SET OutputRoot.*[I] = InputRoot.*[I];
			SET I = I + 1;
		END WHILE;
	END;
END MODULE;
